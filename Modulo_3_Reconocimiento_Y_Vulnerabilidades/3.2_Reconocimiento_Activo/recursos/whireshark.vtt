WEBVTT
X-TIMESTAMP-MAP=LOCAL:00:00:00.000,MPEGTS:0

00:07.349 --> 00:10.970
En este laboratorio, utilizará las herramientas de 
rastreo de red 

00:10.979 --> 00:15.630
tcpdump y Wireshark para capturar y analizar 
el tráfico. 

00:15.640 --> 00:19.860
En la primera parte, preparará a su host para la capturar 
el tráfico de red. 

00:19.870 --> 00:26.250
El primer paso es iniciar sesión en su VM de Kali. El segundo paso 
es recopilar información de red. 

00:26.579 --> 00:31.420
Abra una terminal, ingrese pwd y tome nota
del directorio actual. 

00:31.790 --> 00:35.509
Nos interesan las direcciones IP y MAC
para Ethernet0.

00:35.950 --> 00:42.909
Introduzca ifconfig eth0. Tome nota de la
dirección IP y dirección MAC

00:42.919 --> 00:49.040
para esta interfaz. Ingrese iproute para determinar
una puerta de enlace predeterminada para Ethernet0.

00:49.479 --> 00:54.549
Tome nota de la dirección de la puerta de enlace predeterminada.  
Para conseguir las direcciones DNS,

00:54.560 --> 00:59.919
vea el archivo resolv.conf. Tome nota
de las direcciones DNS.

01:00.750 --> 01:03.459
La primera que se enumere se utilizará primero. 

01:03.720 --> 01:08.629
Las otras direcciones están disponibles si las consultas 
DNS enviadas a la primera dirección no son 

01:08.639 --> 01:14.260
exitosas. 
En la segunda parte, usará tcpdump para capturar y

01:14.269 --> 01:15.620
guardar el tráfico de red. 

01:16.269 --> 01:21.839
Luego, puede ver el archivo de captura de paquetes 
o pcap cuando lo desee en aplicaciones como

01:21.849 --> 01:26.690
 Wireshark. 
El primer paso es iniciar una captura de tcpdump.

01:27.339 --> 01:30.669
Ingrese sudo tcpdump con las siguientes 
opciones. 

01:31.660 --> 01:36.430
La opción i le permite especificar una interfaz
que es Ethernet0.

01:37.080 --> 01:40.169
La opción s 
te permite especificar cuántos bytes 

01:40.180 --> 01:45.180
capturar para cada paquete.  Establece 
esto en 0 para la opción predeterminada 

01:45.190 --> 01:50.809
w te permite escribir la salida de tcpdump 
en un archivo en lugar de analizarlos e imprimirlos en

01:50.819 --> 01:55.169
 la pantalla. 
Asigne un nombre al archivo, como paquete de volcado y

01:55.180 --> 01:57.449
agregue la extensión .pcap.

01:57.919 --> 02:00.809
Este archivo se guardará en su 
directorio actual. 

02:01.949 --> 02:08.669
Presiona enter.  Luego ingrese la contraseña de sudo Kali.
El mensaje de escucha le dice que 

02:08.679 --> 02:13.869
tcpdump ahora está escuchando en Ethernet0
El segundo paso es generar algo de tráfico de red 

02:13.880 --> 02:15.270
desde tu navegador. 

02:16.008 --> 02:18.929
Abra Firefox y vaya a google.com.

02:20.440 --> 02:25.289
Abra una segunda pestaña, vaya a skillsforall.com
e inicia sesión. 

02:27.589 --> 02:33.100
Regresa a tu ventana de terminal donde tcpdump 
se está ejecutando e ingresa control-c para detener

02:33.110 --> 02:37.130
 la captura. 
En la tercera parte, usará Wireshark para ver y

02:37.139 --> 02:40.339
analizar el tráfico que capturó en su archivo 
 pcap.

02:40.350 --> 02:44.589
El primer paso es abrir Wireshark, 
ingresar Wireshark en la línea de comando. 

02:44.940 --> 02:47.559
Abra su archivo pcap dentro de Wireshark.

02:47.800 --> 02:53.970
El segundo paso es analizar el tráfico de DNS. Observar 
las consultas y respuestas DNS le proporciona

02:53.979 --> 03:00.369
 información valiosa y le permite conocer las URL de los sitios 
que visitan con frecuencia los usuarios de su cliente. 

03:00.380 --> 03:05.270
Esta información se puede utilizar en una variedad de 
ataques de ingeniería social, como correos electrónicos de phishing. 

03:05.279 --> 03:10.009
Ingrese dns en el campo de filtro para mostrar 
solo el tráfico DNS. 

03:11.509 --> 03:14.960
Notarás que
además del sitio web skillsforall

03:14.970 --> 03:20.869
que solicitó, se muestran otras búsquedas de DNS,
estas corresponden a enlaces contenidos en

03:20.880 --> 03:27.110
skillsforall y las páginas de inicio de Google. Para buscar
un paquete o una cadena específicos,

03:27.720 --> 03:32.279
elija Buscar paquete en el menú de edición o haga clic
en la lupa.

03:34.550 --> 03:39.860
Seleccione cadena en el menú desplegable de filtro de visualización
y luego ingrese skillsforall como

03:39.869 --> 03:45.259
cadena para filtrar. Ahora, solo los paquetes con
Skillforall en cualquier parte del contenido del paquete

03:45.270 --> 03:51.300
se muestran. Seleccione el primer paquete de consulta estándar DNS
 para ver los detalles del paquete y los bytes del paquete 

03:51.309 --> 03:56.580
si aún no están abiertos. En los 
detalles del paquete, 

03:56.589 --> 04:00.470
abra la sección Ethernet2 para mostrar la 
información de la capa dos. 

04:01.119 --> 04:04.490
Observe que la dirección MAC de origen coincide 
con la que anotamos en 

04:04.500 --> 04:08.419
la primera parte. 
La dirección MAC de destino pertenece a 

04:08.429 --> 04:09.500
la puerta de enlace predeterminada. 

04:10.130 --> 04:14.990
Observe en el encabezado del protocolo de Internet v4 4
que la dirección IP de destino es la 

04:15.008 --> 04:18.350
primera dirección DNS que se muestra en 
resolv.conf

04:18.359 --> 04:25.209
que vimos anteriormente.  DNS normalmente utiliza  
el protocolo de datagrama de usuario al enviar paquetes desde un 

04:25.220 --> 04:29.630
sistema final. 
Observe que el puerto de destino es 53 para DNS.

04:30.260 --> 04:32.989
Expanda la consulta de DNS para ver sus detalles.

04:33.429 --> 04:37.859
Observe que el tipo es A para una consulta4 
IPv4

04:37.869 --> 04:43.700
Las direcciones IPv6 son cuatro A o cuádruple A.
En la parte inferior hay un enlace a 

04:43.709 --> 04:47.829
la respuesta DNS. 
Haga clic en el enlace para abrir ese paquete.  En la 

04:47.839 --> 04:52.920
sección de respuestas, tendrá varias
respuestas.  En el momento de esta grabación

04:53.070 --> 04:58.619
todos estos eran servicios web de Amazon donde se almacena el 
sitio web y el contenido de skillsforall. 

04:58.700 --> 05:01.859
Las direcciones IP en su respuesta de DNS pueden ser
diferentes.

05:02.179 --> 05:05.670
Cierre la aplicación Wireshark y vuelva al 
símbolo del sistema. 

05:06.179 --> 05:11.410
El tercer paso es analizar la solicitud y
paquetes de respuesta en una sesión http.

05:11.850 --> 05:18.269
Esta vez, el sitio web se ejecuta en un contenedor de 
Docker en su máquina virtual.  Ingrese ifconfig y ubique

05:18.279 --> 05:24.489
la interfaz que tiene una dirección IP que
pertenezca a 10. 6.6.la red 0/24.

05:25.359 --> 05:31.829
Tenga en cuenta que la interfaz es br-internal y 
tiene asignada la dirección IP 10. 6.6.1.

05:32.559 --> 05:33.769
Abra Wireshark.

05:35.320 --> 05:40.109
En la lista de interfaces, haga doble clic en
br-internal para iniciar una captura.

05:41.369 --> 05:48.160
Abra una nueva pestaña en Firefox e ingrese 10.6.6.13
y se abrirá la página de inicio de sesión del

05:48.170 --> 05:54.980
servidor web vulnerable.  Ingrese las credenciales, admin
y password e inicie sesión. Haga clic en las instrucciones

05:54.989 --> 05:57.429
del panel izquierdo y luego cierre el navegador.

05:57.859 --> 06:02.869
Regrese a Wireshark y detenga la captura 
haciendo clic en el botón cuadrado rojo en la barra de herramientas. 

06:03.559 --> 06:08.540
Observe que el servidor DVWA usa http y no
https.

06:08.549 --> 06:14.269
Filtre los paquetes para la cadena post, 
haga doble clic 

06:14.279 --> 06:15.739
en el primer paquete resaltado. 

06:16.489 --> 06:19.450
Este es el paquete que enviamos con las credenciales 
de inicio de sesión. 

06:20.170 --> 06:26.920
Expanda la parte de datos que se llama URL de  
formulario HTML codificada.  Debido a que no hay 

06:26.929 --> 06:33.100
cifrado de forma nativa en http, el nombre de usuario y 
la contraseña, así como el token de usuario, están en 

06:33.109 --> 06:39.250
texto sin formato.  Las cookies se utilizan a menudo para guardar
información sobre su sesión, pero las cookies pueden

06:39.260 --> 06:42.170
ser robadas y utilizadas en ataques de secuestro de sesiones.

06:42.410 --> 06:46.989
La cookie inicial para una sesión se envía desde
el servidor web al cliente con el valor de cookie 

06:47.008 --> 06:53.380
establecido en una respuesta http.  Usa control-home 
para volver a la primera línea en la captura de paquetes, 

06:53.390 --> 06:58.529
luego busca la cadena 302 Found  
en el panel de detalles 

06:58.540 --> 07:04.790
del paquete.  Haz doble clic en el primer paquete que se 
encontró y expande la sección de protocolo de 

07:04.799 --> 07:09.890
transporte de hipertexto 
si es necesario. Busque la configuración Set-Cookie.

07:10.809 --> 07:14.910
Este valor se envía en texto sin cifrar porque
no utiliza http seguro.

07:16.170 --> 07:22.709
Tome nota del valor. En el panel de la lista de paquetes, 
ubica la siguiente solicitud get y haz clic

07:22.720 --> 07:24.959
 en ella.  Ubica la configuración para cookie. 

07:25.279 --> 07:30.730
Observe que tiene el mismo ID de sesión. Cierra 
Wireshark o déjalo abierto para una mayor 

07:30.739 --> 07:37.010
exploración por tu cuenta.  Wireshark y tcpdump 
son populares entre los administradores de red, 

07:37.019 --> 07:39.209
ya que se pueden usar para solucionar problemas de red. 

07:39.630 --> 07:44.880
Sin embargo, como ha visto en este laboratorio, 
los actores de amenazas pueden utilizar estas herramientas para 

07:44.890 --> 07:51.350
espiar de forma maliciosa el tráfico de la red y
 recopilar información de forma pasiva.  Como evaluador de

07:51.359 --> 07:54.450
 penetración, 
¿cómo podría utilizar estas herramientas para ayudar 

07:54.459 --> 07:56.940
a sus clientes a reforzar sus redes? 

07:57.160 --> 08:01.429
Una aplicación podría ser capturar tráfico en
la red de su cliente y analizarlo.

08:01.859 --> 08:06.570
Por ejemplo, ¿todos sus dispositivos utilizan 
los últimos estándares de cifrado? 

08:06.970 --> 08:10.230
Diviértase explorando Wireshark de forma segura dentro de
su VM Kali.

