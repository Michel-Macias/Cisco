services:
  kali-attacker:
    image: kalilinux/kali-rolling
    container_name: kali-attacker
    command: tail -f /dev/null
    tty: true
    stdin_open: true
    cap_add:
      - NET_ADMIN
      - NET_RAW
    volumes:
      - kali-data:/root
      - ./scripts:/scripts # Scripts de configuraci√≥n
    networks:
      - pentesting_net
    depends_on:
      - juiceshop
      - webgoat
      - dvwa

  juiceshop:
    image: bkimminich/juice-shop
    container_name: juiceshop-target
    ports:
      - "3000:3000"
    networks:
      - pentesting_net

  webgoat:
    image: webgoat/webgoat
    container_name: webgoat-target
    environment:
      - WEBWOLF_HOST=webwolf-target
      - WEBWOLF_PORT=9080
      - WEBGOAT_START_HSQLDB=true
    command: --hsqldb.port=9001
    ports:
      - "8080:8080"
      - "9001:9001"
    networks:
      - pentesting_net
    healthcheck:
      disable: true

  webwolf:
    image: webgoat/webwolf
    container_name: webwolf-target
    ports:
      - "9080:9080"
    networks:
      - pentesting_net
    environment:
      - WEBWOLF_HOST=webwolf-target
      - WEBWOLF_PORT=9080
      - WEBGOAT_HOST=webgoat-target
      - WEBGOAT_PORT=8080
      - SERVER_PORT=9080
    command: sh -c "sleep 20 && /home/webwolf/start-webwolf.sh --spring.datasource.url=jdbc:hsqldb:hsql://webgoat-target:9001/webgoat --server.port=9080"
    depends_on:
      - webgoat

  dvwa:
    image: vulnerables/web-dvwa
    container_name: dvwa-target
    ports:
      - "8081:80"
    volumes:
      - dvwa-data:/var/lib/mysql
    networks:
      - pentesting_net

  # ========== NUEVOS CONTENEDORES ==========

  bwapp:
    image: raesene/bwapp
    container_name: bwapp-target
    ports:
      - "8082:80"
    networks:
      - pentesting_net

  mutillidae:
    image: citizenstig/nowasp
    container_name: mutillidae-target
    ports:
      - "8083:80"
    networks:
      - pentesting_net

  dvga:
    image: dolevf/dvga
    container_name: dvga-target
    ports:
      - "5013:5013"
    environment:
      - WEB_HOST=0.0.0.0
    networks:
      - pentesting_net

volumes:
  dvwa-data:
  kali-data:
    name: kali-data
    external: true

networks:
  pentesting_net:
    name: red-pentesting-aislada
    external: true
