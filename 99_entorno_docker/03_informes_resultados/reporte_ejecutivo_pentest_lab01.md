# Informe de Auditoría de Seguridad - OWASP Juice Shop

**Fecha:** 17 de Diciembre de 2025
**Auditor:** Consultor de Seguridad (Tú)
**Cliente:** OWASP Juice Shop (Laboratorio 01)
**Alcance:** Aplicación Web Principal (http://localhost:3000)

---

## 1. Resumen Ejecutivo
Durante la evaluación de seguridad realizada al entorno de laboratorio "Laboratorio-Pentesting-01" (OWASP Juice Shop), se han identificado **vulnerabilidades de severidad CRÍTICA**. Estas brechas permitieron comprometer la autenticación administrativa, ejecutar código malicioso en navegadores de usuarios y exfiltrar información confidencial sensible (base de datos de contraseñas).

El nivel de riesgo global de la aplicación se clasifica como **CRÍTICO**. Se requiere una remediación inmediata de los controles de acceso y la sanitización de entradas para asegurar la plataforma.

---

## 2. Resumen de Hallazgos

| ID | Vulnerabilidad | Severidad | Impacto |
| :--- | :--- | :--- | :--- |
| **VULN-01** | Inyección SQL (SQLi) | **Crítica** | Acceso no autorizado como administrador |
| **VULN-02** | Broken Access Control (Exfiltración) | **Crítica** | Robo de base de datos de contraseñas (KeePass) |
| **VULN-03** | Cross-Site Scripting (Reflected XSS) | **Alta** | Ejecución de scripts arbitrarios en clientes |
| **VULN-04** | Session Hijacking | **Alta** | Robo de cookies y suplantación de identidad |
| **VULN-05** | Security Misconfiguration | **Media** | Exposición de funcionalidades ocultas (Scoreboard) |
| **VULN-06** | Improper Error Handling | **Baja** | Fuga de información técnica (Stack Traces) |
| **VULN-07** | DOM-based XSS | **Alta** | Ejecución de scripts en cliente sin pasar por servidor |
| **VULN-08** | Sensitive Data Exposure | **Crítica** | Exposición de directorio FTP con archivos sensibles |

---

## 3. Detalles Técnicos y Mitigación

### VULN-01: Inyección SQL (SQLi)
*   **Descripción:** El formulario de inicio de sesión (`/#/login`) es vulnerable a inyección SQL. La aplicación no sanitiza correctamente la entrada en el campo de correo electrónico, permitiendo manipular la consulta mediante payloads como `' or 1=1--`. Esto permitió el acceso directo a la cuenta de administrador sin conocer la contraseña.
*   **Mitigación:**
    *   **Consultas Preparadas (Prepared Statements):** Utilizar sentencias preparadas donde los parámetros se tratan estrictamente como datos y no como código ejecutable.
    *   **Validación de Entrada:** Implementar validación estricta de tipos y formatos en el lado del servidor.

### VULN-02: Broken Access Control y Exfiltración de Datos
*   **Descripción:** Se identificó un directorio `/ftp` expuesto públicamente. Aunque existía un filtro de extensiones, este pudo ser evadido utilizando "Null Byte Injection" (`%2500`) para descargar archivos restringidos. Se logró exfiltrar un archivo sensible (`incident-support.kdbx`).
*   **Mitigación:**
    *   **Desactivar Listado de Directorios:** Configurar el servidor web para no mostrar el contenido de directorios.
    *   **Control de Acceso:** Verificar permisos de usuario para cada archivo solicitado.
    *   **Corrección de Null Byte:** Actualizar el stack tecnológico y utilizar funciones de manejo de archivos seguras que no sean vulnerables a inyecciones de byte nulo.

### VULN-03: Cross-Site Scripting (XSS)
*   **Descripción:** El buscador de la aplicación permite la inyección de código JavaScript. Aunque existe un filtro básico de seguridad, este fue evadido utilizando payloads ofuscados o alternativos (ej: `<img src=x onerror=...>`).
*   **Mitigación:**
    *   **Codificación de Salida (Output Encoding):** Codificar todos los datos controlados por el usuario antes de renderizarlos en el navegador (convertir caracteres especiales en entidades HTML).
    *   **Content Security Policy (CSP):** Implementar cabeceras CSP robustas para restringir las fuentes de scripts ejecutables.

### VULN-04: Session Hijacking
*   **Descripción:** Aprovechando la vulnerabilidad XSS (VULN-03), fue posible inyectar un script que envía las cookies de sesión del usuario a un servidor controlado por el atacante. Esto permite la suplantación de identidad (Account Takeover).
*   **Mitigación:**
    *   **Cookies Seguras:** Configurar las cookies de sesión con los atributos `HttpOnly` (para evitar acceso desde JS) y `Secure` (solo HTTPS).
    *   **SameSite:** Utilizar el atributo `SameSite=Strict` o `Lax` para prevenir el envío de cookies en peticiones cruzadas.

### VULN-05: Security Misconfiguration - Scoreboard Expuesto
*   **Descripción:** La aplicación expone una vista de "Score Board" (`/#/score-board`) que lista todas las vulnerabilidades posibles de la aplicación. Esto sirve como un mapa de ruta para atacantes, confirmando qué brechas existen y cuáles ya han sido explotadas.
*   **Mitigación:**
    *   **Eliminación en Producción:** Funcionalidades de gamificación o depuración deben ser eliminadas completamente del código desplegado en producción.
    *   **Restricción de Rutas:** Implementar controles de acceso (guards) en el enrutador del cliente y validación en el servidor para impedir el acceso a vistas administrativas.

### VULN-06: Improper Error Handling (Fuga de Información)
*   **Descripción:** Al forzar errores en la aplicación (ej: solicitando tipos de archivo no permitidos en `/ftp`), el servidor devuelve trazas de error completas (Stack Traces). Esto revela versiones de librerías (`Express`), rutas absolutas del servidor (`/juice-shop/build/...`) y nombres de funciones internas (`verify()`).
*   **Mitigación:**
    *   **Manejo Global de Errores:** Implementar un middleware de manejo de errores que capture las excepciones y devuelva mensajes genéricos al usuario (ej: "500 Internal Server Error").
    *   **Logs Internos:** Registrar los detalles técnicos solo en logs del servidor, nunca en la respuesta HTTP.

### VULN-07: DOM-based XSS
*   **Descripción:** La aplicación procesa el parámetro de búsqueda (`q`) directamente en el cliente usando JavaScript, insertándolo en el DOM sin sanitización. Esto permite ejecutar código malicioso sin que el payload llegue al servidor.
*   **Mitigación:**
    *   **Sanitización en Cliente:** Usar librerías como DOMPurify para limpiar cualquier entrada antes de insertarla en el DOM.
    *   **Evitar innerHTML:** Preferir métodos seguros como `textContent` o `innerText` que no interpretan HTML.
    *   **Content Security Policy (CSP):** Implementar políticas estrictas que bloqueen la ejecución de scripts inline.

### VULN-08: Sensitive Data Exposure (Directory Listing)
*   **Descripción:** El directorio `/ftp` está expuesto públicamente sin autenticación, permitiendo listar y descargar archivos sensibles como bases de datos de contraseñas (KeePass), backups de configuración y logs de errores.
*   **Mitigación:**
    *   **Deshabilitar Directory Listing:** Configurar el servidor web para no mostrar contenido de directorios.
    *   **Autenticación:** Implementar control de acceso basado en roles para recursos sensibles.
    *   **Ubicación Segura:** Mover archivos sensibles fuera del webroot o a servicios de almacenamiento dedicados con permisos restrictivos.

---

## 4. Conclusión
La auditoría revela fallos fundamentales en el manejo de la entrada de usuario y los controles de acceso. La capacidad de un atacante para convertirse en administrador, robar sesiones y descargar archivos sensibles demuestra la necesidad urgente de adoptar un enfoque de "Secure by Design" y realizar revisiones de código exhaustivas.
